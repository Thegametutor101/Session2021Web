<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Les Activités</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="../../Ressources/assets/img/logo-departement-informatique.svg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous">
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          rel="stylesheet">
    <!-- STYLESHEET -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="../Ressources/css/Style-Les_Evenements.css">
    <link rel="stylesheet" href="../Ressources/css/Style-Partie-Administrative.css">
    <link rel="stylesheet" href="../Ressources/css/main.css">
    <!-- SCRIPT jquery et fontawesome -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/86aa9796b2.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.js"></script>
    <script src="../../Ressources/javascript/jquery-dateformat.js"></script>
    <script src="../Ressources/javascript/main.js"></script>
    <script>
        $(function() {
            let ua = window.navigator.userAgent;
            //espace volontaire dans le indexOf
            let msie = ua.indexOf("MSIE ");
            if ($.browser.mozilla || (msie > 0)) {
                $("#dateStart").datepicker();
                $("#dateEnd").datepicker();
            }
        });
    </script>
</head>
<body style="background-color: #222831">
<!-- Le slide menu à gauche -->
<div class = "sidenav" id = "mySidenav"></div>
<img onclick = "openNav()" src = "../Ressources/images/Logo_Slide_Menu.png">-
<!-- La div principale qui contient toutes les informations du site web. L'id "main" doit obligatoirement être présent -->
<div id="main">
    <form>
        <div class="card mx-auto" style="width: 85%">
            <h5 class="card-header" id="formName">Ajout d'activité</h5>
            <div class="card-body">
                <div class="mb-4 messages"></div>
                <div class="mb-4">
                    <label for="Nom">Nom</label>
                    <input type="text" class="form-control" id="nom" placeholder="Nom" required>
                </div>
                <div class="mb-4">
                    <label for="description">Description</label>
                    <input type="text" class="form-control" id="description" placeholder="Description" required>
                </div>
                <div class="form-row location mb-4">
                    <div class="form-group col-md-2">
                        <label for="inputCity">Ville</label>
                        <input type="text" class="form-control" id="inputCity" placeholder="Ville" required>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="inputState">Province</label>
                        <select id="inputState" class="form-control">
                            <option value="AB">Alberta</option>
                            <option value="BC">Colombie-Britannique</option>
                            <option value="MB">Manitoba</option>
                            <option value="NB">Nouveau-Brunswick</option>
                            <option value="NL">Terre-Neuve-et-Labrador</option>
                            <option value="NT">Territoires du Nord-Ouest</option>
                            <option value="NS">Nouvelle-Écosse</option>
                            <option value="NU">Nunavut</option>
                            <option value="ON">Ontario</option>
                            <option value="PE">Île-du-Prince-Édouard</option>
                            <option value="QC">Québec</option>
                            <option value="SK">Saskatchewan</option>
                            <option value="YT">Yukon</option>
                        </select>
                    </div>
                    <div class="form-group col-md-3">
                        <label for="inputStreet">Rue</label>
                        <input type="text" class="form-control" id="inputStreet" placeholder="Rue" required>
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputSuite">App.</label>
                        <input type="text" class="form-control" id="inputSuite" placeholder="Appartement">
                    </div>
                    <div class="form-group col-md-2">
                        <label for="inputZip">Code Postal</label>
                        <input type="text" class="form-control" id="inputZip" placeholder="Code Postal" min="6" max="7" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="dateStart">Date de début</label>
                    <input type="datetime-local" class="form-control" id="dateStart" placeholder="Date de début"
                           required>
                </div>
                <div class="mb-4">
                    <label for="dateEnd">Date de fin</label>
                    <input type="datetime-local" class="form-control" id="dateEnd" placeholder="Date de fin" required>
                </div>
                <div class="mb-4">
                    <label for="maxCapacity">Capacité</label>
                    <input type="number" class="form-control" id="maxCapacity" placeholder="Capacité" min="0" max="999999999" required>
                </div>
                <button id="bt-ajouter" type="submit" class="btn btn-primary">Ajouter</button>
            </div>
        </div>
    </form>
</div>
</body>
<script src="../Ressources/javascript/activities.js"></script>
<script>
    checkConnection();
    $.ajax("sideNav.html", {
        success: function (response) {
            let body = response.replace(/^.*?<body>(.*?)<\/body>.*?$/s, "$1");
            $("#mySidenav").html(body);
            $("#navActivities").addClass("selectedPage");
        }
    });
    /* Permet d'ouvrir le slide menu de gauche */
    function openNav(){ $("#mySidenav").css("transform", "translateX(0)"); }
    /* Permet de fermer le slide menu de gauche */
    function closeNav() { $("#mySidenav").css("transform", "translateX(-100%)"); }
    if (typeof getUrlParameter("item") !== 'undefined') {
        $("#formName").text("Modification de l'activité");
        $("#bt-ajouter").text("Soumettre");
        $.ajax({
            url: "../../Management/getActivity.php",
            type: "POST",
            data: { "id": getUrlParameter("item") },
            dataType: "json",
            success: function (result) {
                let location = JSON.parse(result[3]);
                $("#nom").val(result[1]);
                $("#description").val(result[2]);
                $("#inputCity").val(location['city']);
                $("#inputState").val(location['province']);
                $("#inputStreet").val(location['address']);
                $("#inputSuite").val(location['apartment']);
                $("#inputZip").val(location['postalCode']);
                $("#dateStart").val(dateFormat(result[4]));
                $("#dateEnd").val(dateFormat(result[5]));
                $("#maxCapacity").val(result[6]);
            },
            error: function (message, error) {
                $(".messages").append("<div>Erreur de chargement, veuillez réessayer plus tard.</div>");
                window.open("Les-Activités.html", "_self");
            }
        });
    }
    $("#bt-ajouter").click(function (e) {
        e.preventDefault();
        if ($("#inputZip").val().match(/^[a-z]\d[a-z][\s]?\d[a-z]\d$/gi)) {
            if (typeof getUrlParameter("item") !== 'undefined') {
                updateActivity(getUrlParameter("item"),
                    $("#nom").val(),
                    $("#description").val(),
                    $("#inputCity").val(),
                    $("#inputState").val(),
                    $("#inputStreet").val(),
                    $("#inputSuite").val(),
                    $("#inputZip").val(),
                    dateFormat($("#dateStart").val()),
                    dateFormat($("#dateEnd").val()),
                    $("#maxCapacity").val());
            } else {
                addActivity($("#nom").val(),
                    $("#description").val(),
                    $("#inputCity").val(),
                    $("#inputState").val(),
                    $("#inputStreet").val(),
                    $("#inputSuite").val(),
                    $("#inputZip").val(),
                    dateFormat($("#dateStart").val()),
                    dateFormat($("#dateEnd").val()),
                    $("#maxCapacity").val());
            }
        } else {
            $(".messages").append("<div>Veuillez entrer un code postal valide sous format A9A 9A9</div>");
            $("#inputZip").val("");
        }
    });
</script>
</html>