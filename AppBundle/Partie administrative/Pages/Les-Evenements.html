<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Évènements</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="icon" href="../../Ressources/assets/img/logo-departement-informatique.svg">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous">
    <link rel="stylesheet"
          type="text/css"
          href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css">
    <link rel="stylesheet"
          type="text/css"
          href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">
    <!-- STYLESHEET -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="../Ressources/css/Style-Les_Evenements.css">
    <link rel="stylesheet" href="../Ressources/css/Style-Partie-Administrative.css">
    <link rel="stylesheet" href="../Ressources/css/main.css">
    <!-- SCRIPT jquery et fontawesome -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/86aa9796b2.js" crossorigin="anonymous"></script>
    <script src="../../Ressources/javascript/jquery-dateformat.js"></script>
    <script src="../Ressources/javascript/account.js"></script>
</head>
<body>
<!-- Le slide menu à gauche -->
<div id="mySidenav" class="sidenav"></div>
<!-- Le bouton pour accéder au menu-->
<img src="../Ressources/images/Logo_Slide_Menu.png" onclick="openNav()">
<!-- La div principale qui contient toutes les informations du site web. L'id "main" doit obligatoirement être présent -->
<div id="main" style="background-color: white">
    <table id="table" class="table table-striped table-bordered" style="width:100%">
        <thead>
        <tr>
            <th>Nom</th>
            <th>Description</th>
            <th>Location</th>
            <th>Début</th>
            <th>Fin</th>
            <th>Capacité maximale</th>
            <th></th>
        </tr>
        </thead>
        <tbody id="table_body">

        </tbody>
    </table>
</div>
</body>
<script>
    $.ajax("sideNav.html", {
        success: function (response) {
            let body = response.replace(/^.*?<body>(.*?)<\/body>.*?$/s, "$1");
            $("#mySidenav").html(body);
        }
    });
    $("#logOut").click(function (e) {
        sessionStorage.clear();
        window.open("Connexion-Administratif.html", "_self");
    });
    /* Permet d'ouvrir le slide menu de gauche */
    function openNav(){ $("#mySidenav").css("transform", "translateX(0)"); }
    /* Permet de fermer le slide menu de gauche */
    function closeNav() { $("#mySidenav").css("transform", "translateX(-100%)"); }
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" charset="utf8"
        src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
<script>
    $(document).ready(function () {


        function getMonthName(date) {
            const monthNames = ["Janv", "Fevr", "Mars", "Avr", "Mai", "Juin",
                "Juill", "Août", "Sept", "Oct", "Nov", "Dec"
            ];
            return monthNames[date.getMonth()]
        }

        $.ajax({
            url: "../../Management/getEvents.php",
            type: "POST",
            dataType: "json",
            data: {
                "requete": "selectEvents",
            },
            success: function (reponse) {
                reponse.forEach(function (item) {
                    let ds = new Date(item['dateStart'])
                    let de = new Date(item['dateEnd'])
                    let content = "<tr>";
                    content += "<td>" + item['name'] + "</td>";
                    content += "<td>" + item['description'] + "</td>";
                    content += "<td>" + item['location'] + "</td>";
                    content += "<td>" + ds.getFullYear() + "-" + getMonthName(ds) + "-" + ds.getDate() + "</td>";
                    content += "<td>" + de.getFullYear() + "-" + getMonthName(de) + "-" + de.getDate() + "</td>";
                    content += "<td>" + item['maxCapacity'] + "</td>";
                    content += "<td>";
                    content += "<div style='display: flex; justify-content: space-evenly'>"
                    content += "<form  method='post' action='edit_event.php'>"
                    content += "<input hidden name='id'  value='" + item['id'] + "'>"
                    content += " <button type='submit' class='sup btn btn-primary btn-circle-lg align-content-end'><i class='fas fa-pencil-alt'></i></button>"
                    content += "</form>"
                    content += "<form class='del_form' id='" + item['id'] + "'  method='post' >"
                    content += " <button type='submit' class='sup btn btn-primary btn-circle-lg align-content-end'><i class='fas fa-trash'></i></button>"
                    content += "</form>"
                    content += " </div>";
                    content += "</td>";
                    content += "</tr>";
                    document.getElementById('table_body').innerHTML += content;

                })
                table();
            },
            error: function (message, e) {

            }

        });

        $(document).on('click', '.del_form', function (e) {
            e.preventDefault();

            let id = this.id
            Swal.fire({
                title: 'Êtes-vous sûr?',
                text: "Vous ne pourrez pas revenir en arrière!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                cancelButtonText: 'Annuler',
                confirmButtonText: 'Oui, supprimez-le!'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: "../../Management/deleteEvent.php",
                        type: "POST",
                        dataType: "json",
                        data: {
                            "id": id,
                        },
                        success: function (reponse) {
                            let timerInterval
                            Swal.fire({
                                icon: 'success',
                                title: 'Succès',
                                text: 'L\'événement à été ajouté',
                                timer: 1500,
                                timerProgressBar: true,
                                didOpen: () => {
                                    Swal.showLoading()
                                    timerInterval = setInterval(() => {
                                        const content = Swal.getContent()
                                        if (content) {
                                            const b = content.querySelector('b')
                                            if (b) {
                                                b.textContent = Swal.getTimerLeft()
                                            }
                                        }
                                    }, 100)
                                },
                                willClose: () => {
                                    clearInterval(timerInterval)
                                }
                            }).then((result) => {
                                location.reload();
                            })
                        },
                        error: function (message, e) {

                        }

                    });


                }
            })

        });

        function table() {
            $('#table').DataTable({
                "columnDefs": [{
                    "targets": 6,
                    "orderable": false,
                },],
                "language": {
                    "emptyTable": "Aucune donnée disponible dans le tableau",
                    "lengthMenu": "Afficher _MENU_ éléments",
                    "loadingRecords": "Chargement...",
                    "processing": "Traitement...",
                    "zeroRecords": "Aucun élément correspondant trouvé",
                    "paginate": {
                        "first": "Premier",
                        "last": "Dernier",
                        "next": "Suivant",
                        "previous": "Précédent"
                    },
                    "aria": {
                        "sortAscending": ": activer pour trier la colonne par ordre croissant",
                        "sortDescending": ": activer pour trier la colonne par ordre décroissant"
                    },
                    "select": {
                        "rows": {
                            "_": "%d lignes sélectionnées",
                            "0": "Aucune ligne sélectionnée",
                            "1": "1 ligne sélectionnée"
                        },
                        "1": "1 ligne selectionnée",
                        "_": "%d lignes selectionnées",
                        "cells": {
                            "1": "1 cellule sélectionnée",
                            "_": "%d cellules sélectionnées"
                        },
                        "columns": {
                            "1": "1 colonne sélectionnée",
                            "_": "%d colonnes sélectionnées"
                        }
                    },
                    "autoFill": {
                        "cancel": "Annuler",
                        "fill": "Remplir toutes les cellules avec <i>%d<\/i>",
                        "fillHorizontal": "Remplir les cellules horizontalement",
                        "fillVertical": "Remplir les cellules verticalement",
                        "info": "Exemple de remplissage automatique"
                    },
                    "searchBuilder": {
                        "conditions": {
                            "date": {
                                "after": "Après le",
                                "before": "Avant le",
                                "between": "Entre",
                                "empty": "Vide",
                                "equals": "Egal à",
                                "not": "Différent de",
                                "notBetween": "Pas entre",
                                "notEmpty": "Non vide"
                            },
                            "moment": {
                                "after": "Après le",
                                "before": "Avant le",
                                "between": "Entre",
                                "empty": "Vide",
                                "equals": "Egal à",
                                "not": "Différent de",
                                "notBetween": "Pas entre",
                                "notEmpty": "Non vide"
                            },
                            "number": {
                                "between": "Entre",
                                "empty": "Vide",
                                "equals": "Egal à",
                                "gt": "Supérieur à",
                                "gte": "Supérieur ou égal à",
                                "lt": "Inférieur à",
                                "lte": "Inférieur ou égal à",
                                "not": "Différent de",
                                "notBetween": "Pas entre",
                                "notEmpty": "Non vide"
                            },
                            "string": {
                                "contains": "Contient",
                                "empty": "Vide",
                                "endsWith": "Se termine par",
                                "equals": "Egal à",
                                "not": "Différent de",
                                "notEmpty": "Non vide",
                                "startsWith": "Commence par"
                            },
                            "array": {
                                "equals": "Egal à",
                                "empty": "Vide",
                                "contains": "Contient",
                                "not": "Différent de",
                                "notEmpty": "Non vide",
                                "without": "Sans"
                            }
                        },
                        "add": "Ajouter une condition",
                        "button": {
                            "0": "Recherche avancée",
                            "_": "Recherche avancée (%d)"
                        },
                        "clearAll": "Effacer tout",
                        "condition": "Condition",
                        "data": "Donnée",
                        "deleteTitle": "Supprimer la règle de filtrage",
                        "logicAnd": "Et",
                        "logicOr": "Ou",
                        "title": {
                            "0": "Recherche avancée",
                            "_": "Recherche avancée (%d)"
                        },
                        "value": "Valeur"
                    },
                    "searchPanes": {
                        "clearMessage": "Effacer tout",
                        "count": "{total}",
                        "title": "Filtres actifs - %d",
                        "collapse": {
                            "0": "Volet de recherche",
                            "_": "Volet de recherche (%d)"
                        },
                        "countFiltered": "{shown} ({total})",
                        "emptyPanes": "Pas de volet de recherche",
                        "loadMessage": "Chargement du volet de recherche..."
                    },
                    "buttons": {
                        "copyKeys": "Appuyer sur ctrl ou u2318 + C pour copier les données du tableau dans votre presse-papier.",
                        "collection": "Collection",
                        "colvis": "Visibilité colonnes",
                        "colvisRestore": "Rétablir visibilité",
                        "copy": "Copier",
                        "copySuccess": {
                            "1": "1 ligne copiée dans le presse-papier",
                            "_": "%ds lignes copiées dans le presse-papier"
                        },
                        "copyTitle": "Copier dans le presse-papier",
                        "csv": "CSV",
                        "excel": "Excel",
                        "pageLength": {
                            "-1": "Afficher toutes les lignes",
                            "1": "Afficher 1 ligne",
                            "_": "Afficher %d lignes"
                        },
                        "pdf": "PDF",
                        "print": "Imprimer"
                    },
                    "decimal": ",",
                    "info": "Affichage de _START_ à _END_ sur _TOTAL_ éléments",
                    "infoEmpty": "Affichage de 0 à 0 sur 0 éléments",
                    "infoFiltered": "(filtrés de _MAX_ éléments au total)",
                    "infoThousands": ".",
                    "search": "Rechercher:",
                    "searchPlaceholder": "Rechercher...",
                    "thousands": "."
                }
            });
        }

    });
</script>
</html>